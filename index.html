<!DOCTYPE html><html lang="zh-HK"><head><meta charset="utf-8" /><meta name="viewport" content="width=device-width, initial-scale=1" /><title>æˆ‘çš„å¿ƒæƒ…æ—¥è¨˜</title><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css"><link href="https://fonts.googleapis.com/css2?family=cwTeXYen&display=swap" rel="stylesheet"><style>  :root {    --theme-main: #ffca28; /* Amber */    --theme-dark: #ff6f00; /* Dark Orange */    --bg-color: #fff8e1;    --panel-bg: #ffffff;  }  body {    font-family: "cwTeXYen", "Microsoft JhengHei", sans-serif; /* Cute font */    background-color: var(--bg-color);    margin: 0;    padding: 20px;    color: #444;  }  .container {    max-width: 800px;    margin: 0 auto;    background: var(--panel-bg);    border: 4px solid var(--theme-main);    border-radius: 25px;    padding: 25px;    box-shadow: 0 10px 20px rgba(0,0,0,0.1);  }  h1 {    text-align: center;    color: var(--theme-dark);    margin-top: 0;    font-size: 2.2rem;  }  /* --- SECTIONS --- */  .section {    margin-bottom: 25px;    background: #fff;    border-radius: 15px;    padding: 15px;    border: 2px solid #eee;  }    .section-label {    font-size: 1.2rem;    color: var(--theme-dark);    font-weight: bold;    display: flex;    align-items: center;    gap: 10px;    margin-bottom: 10px;  }  /* --- INPUTS --- */  input, select, textarea {    width: 100%;    padding: 12px;    border: 2px solid #ddd;    border-radius: 12px;    font-size: 1.1rem;    font-family: inherit;    box-sizing: border-box;    transition: 0.3s;  }  input:focus, select:focus, textarea:focus {    outline: none;    border-color: var(--theme-main);    background: #fffde7;  }  /* --- VOICE BUTTONS --- */  .voice-box {    display: flex;    gap: 10px;    align-items: center;    background: #f0f0f0;    padding: 8px;    border-radius: 15px;    margin-bottom: 10px;  }    .btn-icon {    border: none;    padding: 10px 20px;    border-radius: 20px;    font-size: 1rem;    cursor: pointer;    display: flex;    align-items: center;    gap: 8px;    font-weight: bold;    transition: transform 0.1s;  }  .btn-icon:active { transform: scale(0.95); }    .btn-mic { background: #ffcdd2; color: #d32f2f; }  .btn-mic.listening { background: #d32f2f; color: white; animation: pulse 1s infinite; }  .btn-read { background: #e1bee7; color: #7b1fa2; }    @keyframes pulse { 0% { opacity: 1; } 50% { opacity: 0.7; } 100% { opacity: 1; } }  /* --- DRAWING AREA --- */  .canvas-wrapper {    position: relative;    border: 3px dashed #ccc;    border-radius: 15px;    overflow: hidden;    background: white;    touch-action: none; /* Critical for drawing on tablet */  }  .canvas-tools {    display: flex;    gap: 10px;    margin-bottom: 10px;    flex-wrap: wrap;  }  .mode-btn {    flex: 1;    padding: 10px;    border: 2px solid #ccc;    background: white;    border-radius: 12px;    font-size: 1.1rem;    cursor: pointer;    text-align: center;  }  .mode-btn.active {    border-color: var(--theme-dark);    background: #fff3e0;    color: var(--theme-dark);    font-weight: bold;  }  /* Sub-toolbars (Hidden by default) */  .sub-toolbar {    display: none; /* JS toggles this */    width: 100%;    background: #fafafa;    padding: 10px;    border-radius: 10px;    margin-top: 5px;    align-items: center;    gap: 10px;  }  .sub-toolbar.show { display: flex; }  /* Color/Size inputs */  input[type="color"] { width: 50px; height: 40px; padding: 0; border: none; cursor: pointer; }  input[type="range"] { width: 100px; cursor: pointer; }  /* Emoji List */  .emoji-list {    display: flex;    gap: 8px;    overflow-x: auto;    padding-bottom: 5px;  }  .emoji-item {    font-size: 2rem;    cursor: pointer;    padding: 5px;    border-radius: 10px;    border: 2px solid transparent;    background: white;  }  .emoji-item:hover { background: #eee; }  .emoji-item.selected { border-color: var(--theme-dark); background: #ffe0b2; transform: scale(1.1); }  /* --- SAVE BUTTON --- */  .btn-save {    width: 100%;    padding: 18px;    background: var(--theme-dark);    color: white;    font-size: 1.3rem;    border: none;    border-radius: 15px;    cursor: pointer;    margin-top: 20px;    font-weight: bold;    box-shadow: 0 5px 0 #e65100;  }  .btn-save:active { transform: translateY(4px); box-shadow: none; }</style></head><body><div class="container">  <h1>âœï¸ æˆ‘çš„å¿ƒæƒ…æ—¥è¨˜</h1>  <div class="section">    <div class="section-label"><i class="far fa-calendar-alt"></i> æ—¥æœŸ</div>    <input type="date" id="dateInput">  </div>  <div class="section">    <div class="section-label"><i class="fas fa-map-marker-alt"></i> åœ°é»</div>    <select id="locationSelect" onchange="checkLocation()">      <option value="å­¸æ ¡">ğŸ« å­¸æ ¡</option>      <option value="å±‹ä¼">ğŸ  å±‹ä¼</option>      <option value="å…¬åœ’">ğŸŒ³ å…¬åœ’</option>      <option value="other">âœï¸ å…¶ä»–...</option>    </select>    <input type="text" id="locationOther" style="display:none; margin-top:10px;" placeholder="è«‹è¼¸å…¥åœ°é»">  </div>  <div class="section">    <div class="section-label"><i class="fas fa-comment-dots"></i> äº‹æƒ…</div>        <div class="voice-box">      <select id="voiceSelect" style="flex:1;">        <option>æ­£åœ¨å°‹æ‰¾èªéŸ³...</option>      </select>            <button class="btn-icon btn-read" onclick="speak()">        <i class="fas fa-volume-up"></i> æœ—è®€      </button>      <button class="btn-icon btn-mic" id="micBtn" onclick="toggleMic()">        <i class="fas fa-microphone"></i> èªªè©±      </button>    </div>    <textarea id="eventText" rows="3" placeholder="ä»Šå¤©ç™¼ç”Ÿäº†ä»€éº¼äº‹ï¼Ÿ"></textarea>  </div>  <div class="section">    <div class="section-label"><i class="fas fa-palette"></i> å¿ƒæƒ…ç•«æ¿</div>    <div class="canvas-tools">      <div class="mode-btn active" id="btnModeDraw" onclick="setMode('draw')">        ğŸ–Œï¸ ç•«ç•« (Draw)      </div>      <div class="mode-btn" id="btnModeSticker" onclick="setMode('sticker')">        ğŸ˜€ è²¼åœ– (Sticker)      </div>      <div class="mode-btn" style="background:#ffebee; color:#c62828; border-color:#ffcdd2; flex:0 0 auto;" onclick="clearCanvas()">        <i class="fas fa-trash"></i> æ¸…é™¤      </div>    </div>    <div id="toolbarDraw" class="sub-toolbar show">      <span>é¡è‰²:</span>      <input type="color" id="brushColor" value="#000000">      <span style="margin-left:10px;">ç²—å¹¼:</span>      <input type="range" id="brushSize" min="2" max="30" value="5">      <button class="btn-icon" style="background:white; border:1px solid #ccc; padding:5px 15px;" onclick="activateEraser()">        <i class="fas fa-eraser"></i> æ“¦è†       </button>    </div>    <div id="toolbarSticker" class="sub-toolbar">      <div class="emoji-list">        <div class="emoji-item" onclick="pickEmoji('ğŸ˜€')">ğŸ˜€</div>        <div class="emoji-item" onclick="pickEmoji('ğŸ˜¢')">ğŸ˜¢</div>        <div class="emoji-item" onclick="pickEmoji('ğŸ˜¡')">ğŸ˜¡</div>        <div class="emoji-item" onclick="pickEmoji('ğŸ˜­')">ğŸ˜­</div>        <div class="emoji-item" onclick="pickEmoji('ğŸ¥°')">ğŸ¥°</div>        <div class="emoji-item" onclick="pickEmoji('ğŸ˜´')">ğŸ˜´</div>        <div class="emoji-item" onclick="pickEmoji('ğŸ¤¯')">ğŸ¤¯</div>        <div class="emoji-item" onclick="pickEmoji('ğŸ˜·')">ğŸ˜·</div>        <div class="emoji-item" onclick="pickEmoji('ğŸ‰')">ğŸ‰</div>        <div class="emoji-item" onclick="pickEmoji('ğŸ’¯')">ğŸ’¯</div>      </div>      <span style="font-size:0.9rem; color:#666;">(é¸ä¸€å€‹ï¼Œç„¶å¾Œé»æ“Šç•«å¸ƒ)</span>    </div>    <div class="canvas-wrapper">      <canvas id="drawingCanvas" width="800" height="400"></canvas>    </div>  </div>  <button class="btn-save" onclick="saveFiles()">    <i class="fas fa-save"></i> å„²å­˜æ—¥è¨˜ (Save)  </button></div><script>// --- INIT ---document.getElementById('dateInput').valueAsDate = new Date();const canvas = document.getElementById('drawingCanvas');const ctx = canvas.getContext('2d');// Initialize White Background (Important for JPG export)ctx.fillStyle = "white";ctx.fillRect(0, 0, canvas.width, canvas.height);// --- 1. VOICE LOGIC (SIMPLIFIED) ---const voiceSelect = document.getElementById('voiceSelect');let voices = [];function loadVoices() {  voices = window.speechSynthesis.getVoices();  voiceSelect.innerHTML = '';    let found = false;  voices.forEach(v => {    const lang = v.lang;    const name = v.name;    let label = "";    // Logic to rename and filter voices for Primary Students    if (lang.includes('HK') || lang === 'yue') {        if (name.includes('Sinji') || name.includes('Tracy') || name.includes('HiuGaai')) {            label = "ğŸ—£ï¸ å»£æ±è©± (å¥³è²)";        } else if (name.includes('Danny')) {            label = "ğŸ—£ï¸ å»£æ±è©± (ç”·è²)";        } else {            label = "ğŸ—£ï¸ å»£æ±è©±";        }    } else if (lang.includes('TW') || (lang.includes('CN') && !lang.includes('HK'))) {        label = "ğŸ—£ï¸ åœ‹èª (æ™®é€šè©±)";    }    // Only add if it matches our simplified categories    if (label !== "") {        let opt = document.createElement('option');        opt.value = v.name;        opt.innerText = label + ` [${v.name.split(' ')[0]}]`; // Add short system name for debug        voiceSelect.appendChild(opt);        found = true;    }  });  if (!found) {    let opt = document.createElement('option');    opt.innerText = "æ‰¾ä¸åˆ°ä¸­æ–‡èªéŸ³ (ä½¿ç”¨ç³»çµ±é è¨­)";    voiceSelect.appendChild(opt);  }}window.speechSynthesis.onvoiceschanged = loadVoices;setTimeout(loadVoices, 500);function speak() {    const txt = document.getElementById('eventText').value;    if(!txt) return;    const utter = new SpeechSynthesisUtterance(txt);    const selected = voiceSelect.value;    if(selected) utter.voice = voices.find(v => v.name === selected);    window.speechSynthesis.speak(utter);}// --- 2. STT (Cantonese) ---let recognition;let isListening = false;if ('webkitSpeechRecognition' in window) {    recognition = new webkitSpeechRecognition();    recognition.continuous = false;    recognition.lang = "zh-HK";         recognition.onstart = () => {        isListening = true;        document.getElementById('micBtn').classList.add('listening');        document.getElementById('micBtn').innerHTML = '<i class="fas fa-stop"></i> è†è½ä¸­...';    };    recognition.onend = () => {        isListening = false;        document.getElementById('micBtn').classList.remove('listening');        document.getElementById('micBtn').innerHTML = '<i class="fas fa-microphone"></i> èªªè©±';    };    recognition.onresult = (e) => {        document.getElementById('eventText').value += e.results[0][0].transcript;    };}function toggleMic() {    if(!recognition) return alert("è«‹ä½¿ç”¨ Google Chrome");    if(isListening) recognition.stop(); else recognition.start();}// --- 3. DRAWING & STICKER LOGIC ---let mode = 'draw'; // 'draw' or 'sticker'let isDrawing = false;let selectedEmoji = 'ğŸ˜€';function setMode(newMode) {    mode = newMode;    // Update UI    document.getElementById('btnModeDraw').classList.toggle('active', mode === 'draw');    document.getElementById('btnModeSticker').classList.toggle('active', mode === 'sticker');    document.getElementById('toolbarDraw').classList.toggle('show', mode === 'draw');    document.getElementById('toolbarSticker').classList.toggle('show', mode === 'sticker');}function activateEraser() {    ctx.globalCompositeOperation = "destination-out";    ctx.lineWidth = 20;}function clearCanvas() {    ctx.globalCompositeOperation = "source-over";    ctx.fillStyle = "white";    ctx.fillRect(0,0,canvas.width, canvas.height);}function pickEmoji(emoji) {    selectedEmoji = emoji;    // Highlight    document.querySelectorAll('.emoji-item').forEach(el => {        el.classList.toggle('selected', el.innerText === emoji);    });}// Canvas Eventsfunction getPos(e) {    const rect = canvas.getBoundingClientRect();    const scaleX = canvas.width / rect.width;    const scaleY = canvas.height / rect.height;    const clientX = e.clientX || e.touches[0].clientX;    const clientY = e.clientY || e.touches[0].clientY;    return {        x: (clientX - rect.left) * scaleX,        y: (clientY - rect.top) * scaleY    };}function startAction(e) {    e.preventDefault();    const pos = getPos(e);        if (mode === 'sticker') {        // STAMP EMOJI        ctx.globalCompositeOperation = "source-over";        ctx.font = "80px Arial";        ctx.textAlign = "center";        ctx.textBaseline = "middle";        ctx.fillText(selectedEmoji, pos.x, pos.y);    } else {        // START DRAWING        isDrawing = true;        ctx.beginPath();        ctx.moveTo(pos.x, pos.y);        // Ensure we aren't in eraser mode unless Eraser button was clicked,         // but here we just reset to brush if simple brush logic:        if (ctx.globalCompositeOperation === 'destination-out') {           // Keep eraser        } else {           ctx.globalCompositeOperation = "source-over";           ctx.strokeStyle = document.getElementById('brushColor').value;           ctx.lineWidth = document.getElementById('brushSize').value;           ctx.lineCap = "round";           ctx.lineJoin = "round";        }    }}function moveAction(e) {    if (!isDrawing || mode !== 'draw') return;    e.preventDefault();    const pos = getPos(e);    ctx.lineTo(pos.x, pos.y);    ctx.stroke();}function endAction() { isDrawing = false; }canvas.addEventListener('mousedown', startAction);canvas.addEventListener('mousemove', moveAction);canvas.addEventListener('mouseup', endAction);canvas.addEventListener('touchstart', startAction);canvas.addEventListener('touchmove', moveAction);canvas.addEventListener('touchend', endAction);// --- 4. EXPORT (TWO FILES) ---function checkLocation() {    const val = document.getElementById('locationSelect').value;    document.getElementById('locationOther').style.display = (val === 'other') ? 'block' : 'none';}function saveFiles() {    // 1. Get Data    const date = document.getElementById('dateInput').value;    let loc = document.getElementById('locationSelect').value;    if(loc === 'other') loc = document.getElementById('locationOther').value;    const text = document.getElementById('eventText').value;    // 2. Download CSV (Excel Data)    // Add BOM (\uFEFF) so Excel reads Chinese correctly    const csvContent = "\uFEFF" + `æ—¥æœŸ,åœ°é»,äº‹æƒ…\n${date},${loc},${text}`;    const csvBlob = new Blob([csvContent], { type: 'text/csv;charset=utf-8;' });    const csvUrl = URL.createObjectURL(csvBlob);        const link1 = document.createElement("a");    link1.href = csvUrl;    link1.download = `Diary_${date}.csv`;    document.body.appendChild(link1);    link1.click();    document.body.removeChild(link1);    // 3. Download Image (JPG)    // Small delay to ensure browser handles two downloads    setTimeout(() => {        const link2 = document.createElement('a');        link2.download = `Drawing_${date}.jpg`;        // Convert to JPG (white background is set in INIT)        link2.href = canvas.toDataURL("image/jpeg", 0.9);        document.body.appendChild(link2);        link2.click();        document.body.removeChild(link2);                alert("æˆåŠŸï¼å·²ä¸‹è¼‰å…©å€‹æª”æ¡ˆï¼š\n1. æ—¥è¨˜æ–‡å­— (Excel/CSV)\n2. ç•«ä½œåœ–ç‰‡ (JPG)");    }, 500);}</script></body></html>